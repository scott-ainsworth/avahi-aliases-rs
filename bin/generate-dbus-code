#!/bin/bash

SED=$(which gsed || which sed)

echo $'#![allow(clippy::all)]'
#echo $'#![allow(single_use_lifetimes)]'
#echo $'#![rustfmt::skip]'
dbus-codegen-rust --system-bus --client blocking \
| $SED \
    -e $'/This code was autogenerated/s:, see:.\\n// See:' \
    -e $'/^use dbus as dbus;$/d' \
    -e $'/^#\\[allow(unused_imports)\\]$/d' \
    -e $'/^\s*fn /s/arg::Iter\>/&<\'_>/' \
    -e $'/^\s*fn /s/arg::IterAppend\>/&<\'_>/'
